{"version":3,"file":"Pixim.js","sources":["../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../src/modules/Emitter.ts","../node_modules/@tawaship/task/dist/Task.esm.js","../src/modules/Task.ts","../src/modules/Container.ts","../src/modules/Application.ts","../src/modules/ContentManifestBase.ts","../src/modules/ContentImageManifest.ts","../src/modules/ContentSpritesheetManifest.ts","../src/modules/ContentSoundManifest.ts","../src/modules/ContentDeliver.ts","../src/modules/Content.ts","../src/modules/utils/index.ts","../src/modules/loaders/LoaderBase.ts","../src/modules/loaders/TextureLoader.ts","../src/modules/loaders/SpritesheetLoader.ts","../src/modules/resources/ResourceManagerBase.ts","../src/modules/resources/ImageResourceManager.ts"],"sourcesContent":["/*!\n * @tawaship/emitter - v3.1.1\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    _on(type, callback, once) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ callback, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    on(type, callback) {\r\n        return this._on(type, callback, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Callback when the event fires.\r\n     */\r\n    once(type, callback) {\r\n        return this._on(type, callback, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param callback Registered callback.\r\n     */\r\n    off(type, callback) {\r\n        if (!type || !callback) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].callback === callback) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    _emit(type, context, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const targets = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const event = events[i];\r\n            if (event.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            targets.push(event);\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emit(type, ...args) {\r\n        return this._emit(type, this, ...args);\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        return this._emit(type, context, ...args);\r\n    }\r\n    _emitAll(context, ...args) {\r\n        if (context == null) {\r\n            return this;\r\n        }\r\n        const targets = [];\r\n        for (let type in this._events) {\r\n            const events = this._events[type] || [];\r\n            for (let i = events.length - 1; i >= 0; i--) {\r\n                const event = events[i];\r\n                if (event.once) {\r\n                    events.splice(i, 1);\r\n                }\r\n                targets.push(event);\r\n            }\r\n        }\r\n        for (let i = targets.length - 1; i >= 0; i--) {\r\n            targets[i].callback.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit all events.\r\n     *\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    emitAll(...args) {\r\n        return this._emitAll(this, ...args);\r\n    }\r\n    /**\r\n     * Emit all events with specifying a context.\r\n     *\r\n     * @param context Context to execute the callback.\r\n     * @param args Argument(s) in callback.\r\n     */\r\n    cemitAll(context, ...args) {\r\n        return this._emitAll(context, ...args);\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove. If it is empty, removes all events.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","import { Emitter as _Emitter } from '@tawaship/emitter';\r\n\r\n/**\r\n * [[https://tawaship.github.io/Emitter/index.html | @tawaship/emitter]]\r\n */\r\nexport class Emitter extends _Emitter {}","/*!\n * @tawaship/task - v1.1.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Task {\r\n    constructor(callbacks, context) {\r\n        this._taskData = {\r\n            context: context == null ? this : context,\r\n            enabled: true,\r\n            index: -1,\r\n            callbacks: [],\r\n            value: null\r\n        };\r\n        this.add(callbacks);\r\n    }\r\n    /**\r\n     * Whether the task works.\r\n     */\r\n    get enabled() {\r\n        return this._taskData.enabled;\r\n    }\r\n    set enabled(enabled) {\r\n        this._taskData.enabled = enabled;\r\n    }\r\n    /**\r\n     * Add the task to the end of the list.\r\n     */\r\n    add(callbacks) {\r\n        if (!Array.isArray(callbacks)) {\r\n            callbacks = [callbacks];\r\n        }\r\n        const list = this._taskData.callbacks;\r\n        const flag = list.length === 0;\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (!(callbacks[i] instanceof Function)) {\r\n                continue;\r\n            }\r\n            list.push(callbacks[i]);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Execute the current task.\r\n     */\r\n    done(...args) {\r\n        if (!this._taskData.enabled) {\r\n            return;\r\n        }\r\n        const task = this._taskData.callbacks[this._taskData.index];\r\n        if (!task) {\r\n            return;\r\n        }\r\n        return this._taskData.value = task.apply(this._taskData.context, args);\r\n    }\r\n    _to(index) {\r\n        this._taskData.index = Number(index);\r\n        return this;\r\n    }\r\n    /**\r\n     * Change the current task to the first task.\r\n     */\r\n    first() {\r\n        return this._to(0);\r\n    }\r\n    /**\r\n     * Change the current task to the previos task.\r\n     */\r\n    prev() {\r\n        return this._to(this._taskData.index - 1);\r\n    }\r\n    /**\r\n     * Change the current task to the next task.\r\n     */\r\n    next() {\r\n        return this._to(this._taskData.index + 1);\r\n    }\r\n    /**\r\n     * Change the current task to the specified task.\r\n     */\r\n    to(index) {\r\n        return this._to(index);\r\n    }\r\n    /**\r\n     * Skips all tasks and changes to the finished state.\r\n     */\r\n    finish() {\r\n        this._taskData.index = -1;\r\n        return this;\r\n    }\r\n    /**\r\n     * Cancel all task and leave them unregistered.\r\n     */\r\n    reset() {\r\n        this._taskData.callbacks = [];\r\n        this._taskData.index = -1;\r\n        this._taskData.value = null;\r\n        return this;\r\n    }\r\n    /**\r\n     * Destroy instance.\r\n     */\r\n    destroy() {\r\n        this.reset();\r\n    }\r\n    /**\r\n     * The value returned by the last task executed.\r\n     */\r\n    get value() {\r\n        return this._taskData.value;\r\n    }\r\n}\n\nexport { Task };\n//# sourceMappingURL=Task.esm.js.map\n","import { Emitter } from './Emitter';\r\nimport { Task as _Task, ITaskDelegate } from '@tawaship/task';\r\n\r\nexport interface ITaskData {\r\n\temitter: Emitter\r\n}\r\n\r\n/**\r\n * [[https://tawaship.github.io/Task/index.html | @tawaship/task]]\r\n */\r\nexport class Task extends _Task {\r\n\tprivate _piximData: ITaskData;\r\n\t\r\n\tconstructor(tasks: ITaskDelegate | ITaskDelegate[], context: any) {\r\n\t\tsuper(tasks, context);\r\n\t\t\r\n\t\tthis.enabled = true;\r\n\t\tthis._piximData = {\r\n\t\t\temitter: new Emitter()\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\ton(type: string, callback: ITaskDelegate) {\r\n\t\tthis._piximData.emitter.on(type, callback);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\tonce(type: string, callback: ITaskDelegate) {\r\n\t\tthis._piximData.emitter.once(type, callback);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\toff(type: string, callback: ITaskDelegate) {\r\n\t\tthis._piximData.emitter.off(type, callback);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\temit(type: string, ...args: any[]) {\r\n\t\tif (!this._taskData.enabled) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.emitter.emit(type, ...args);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\tcemit(type: string, context: any, ...args: any[]) {\r\n\t\tif (!this._taskData.enabled) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.emitter.cemit(type, context, ...args);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.9.0\r\n\t */\r\n\temitAll(...args: any[]) {\r\n\t\tif (!this._taskData.enabled) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.emitter.emitAll(...args);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.9.0\r\n\t */\r\n\tcemitAll(context: any, ...args: any[]) {\r\n\t\tif (!this._taskData.enabled) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.emitter.cemitAll(context, ...args);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @deprecated 1.7.0\r\n\t */\r\n\tclear(type: string = '') {\r\n\t\tthis._piximData.emitter.clear(type);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\t\tthis.clear();\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { Task } from './Task';\r\n//import { TaskManager } from './TaskManager';\r\nimport { ITickerData } from './Application';\r\n\r\nexport interface IContainerData {\r\n\ttask: Task,\r\n\ttaskEnabledChildren: boolean\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nlet _lastObserverID = 0;\r\n\r\n/**\r\n * [[http://pixijs.download/release/docs/PIXI.Container.html]]\r\n */\r\nexport class Container extends PIXI.Container {\r\n\tprotected _piximData: IContainerData;\r\n\t\r\n\tconstructor(...args: any[]) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._piximData = {\r\n\t\t\ttask: new Task([], this),\r\n\t\t\ttaskEnabledChildren: true\r\n\t\t};\r\n\t\t\r\n\t\tthis._piximData.task.first();\r\n\t\t\r\n\t\tconst _observerID = _lastObserverID++;\r\n\t\t/*\r\n\t\tthis.on('added', () => {\r\n\t\t\tTaskManager.addObserver(_observerID, this);\r\n\t\t});\r\n\t\t\r\n\t\tthis.on('removed', () => {\r\n\t\t\tTaskManager.removeObserver(_observerID);\r\n\t\t});\r\n\t\t*/\r\n\t}\r\n\t\r\n\tupdateTask(e: ITickerData) {\r\n\t\tconst task: Task = this._piximData.task;\r\n\t\t\r\n\t\tif (!this._piximData.task.enabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t/*\r\n\t\tlet p: PIXI.DisplayObject = this;\r\n\t\tlet f = true;\r\n\t\t\r\n\t\twhile (p) {\r\n\t\t\tif (p instanceof Container && !p.taskEnabledChildren) {\r\n\t\t\t\tf = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tp = p.parent;\r\n\t\t}\r\n\t\t\r\n\t\tif (!f) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n\t\t\r\n\t\ttask.done(e);\r\n\t\t\r\n\t\t// will be deprecated\r\n\t\ttask.cemitAll(this, e);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Whether the task works.\r\n\t */\r\n\tget taskEnabled(): boolean {\r\n\t\treturn this._piximData.task.enabled;\r\n\t}\r\n\t\r\n\tset taskEnabled(enabled) {\r\n\t\tthis._piximData.task.enabled = enabled;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Whether the children and subsequent tasks work.\r\n\t */\r\n\tget taskEnabledChildren(): boolean {\r\n\t\treturn this._piximData.taskEnabledChildren;\r\n\t}\r\n\t\r\n\tset taskEnabledChildren(enabled) {\r\n\t\tthis._piximData.taskEnabledChildren = enabled;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Task object that works only while it is being displayed.\r\n\t */\r\n\tget task(): Task {\r\n\t\treturn this._piximData.task;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Destroy instance.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tdestroy(...args: any[]): void {\r\n\t\tsuper.destroy(...args);\r\n\t\tthis._piximData.task.destroy();\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { Content } from './Content';\r\nimport { Container } from './Container';\r\nimport { Emitter } from './Emitter';\r\n//import { TaskManager } from './TaskManager';\r\n\r\nexport interface IContentDictionary {\r\n\t[id: string]: Content;\r\n}\r\n\r\nexport interface IRootDictionary {\r\n\t[id: string]: PIXI.Container;\r\n}\r\n\r\nexport interface ILayerDictionary{\r\n\t[name: string]: Layer;\r\n}\r\n\r\nexport interface ITickerData {\r\n\tdelta: number\r\n}\r\n\r\nexport interface IAdjustDelegate {\r\n\t(app: Application): void;\r\n}\r\n\r\nexport type TAutoAdjust = boolean | IAdjustDelegate;\r\n\r\nexport interface IAutoAdjustDelegate {\r\n\t(): void;\r\n}\r\n\r\nexport type TAutoAdjuster = IAutoAdjustDelegate | null;\r\n\r\nexport interface IApplicationOption {\r\n\t/**\r\n\t * Parent node of canvas element.\r\n\t */\r\n\tcontainer?: HTMLElement;\r\n\t\r\n\t/**\r\n\t * Whether to automatically resize the canvas when resizing the window.<br />\r\n\t * Or the resizing process to be executed at that time.\r\n\t */\r\n\tautoAdjust?: TAutoAdjust;\r\n}\r\n\r\nexport interface IApplicationData {\r\n\tisRun: boolean;\r\n\t/**\r\n\t * [[[[http://pixijs.download/v5.2.1/docs/PIXI.Application.html | PIXI.Application]]]]\r\n\t */\r\n\tapp: PIXI.Application;\r\n\tcontainer: HTMLElement;\r\n\tlayers: ILayerDictionary;\r\n\tautoAdjuster: TAutoAdjuster;\r\n\troots: IRootDictionary;\r\n\tcontents: IContentDictionary;\r\n}\r\n\r\nexport interface ISize {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IPosition {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport interface IHorizontal {\r\n\tx: number;\r\n\twidth: number;\r\n}\r\n\r\nexport interface IVertical {\r\n\ty: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IRect extends ISize, IPosition {}\r\n\r\nexport interface IDestroyOptions {\r\n\tchildren?: boolean;\r\n\ttexture?: boolean;\r\n\tbaseTexture?: boolean;\r\n}\r\n\r\nexport class Layer extends PIXI.Container {}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction taskHandler(obj: PIXI.Container, e: ITickerData): void {\r\n\tif (obj instanceof Container) {\r\n\t\tobj.updateTask(e);\r\n\t\t\r\n\t\tif (!obj.taskEnabledChildren) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst children: PIXI.DisplayObject[] = [];\r\n\t\r\n\tfor (let i = 0; i < obj.children.length; i++) {\r\n\t\tchildren.push(obj.children[i]);\r\n\t}\r\n\t\r\n\tfor (let i = 0; i < children.length; i++) {\r\n\t\tconst child = children[i];\r\n\t\t\r\n\t\tif (child instanceof PIXI.Container) {\r\n\t\t\ttaskHandler(child, e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class Application extends Emitter {\r\n\tprotected _piximData: IApplicationData;\r\n\t\r\n\t/**\r\n\t * @param pixiOptions Optional data when call 'new [[[[http://pixijs.download/v5.2.1/docs/PIXI.Application.html | PIXI.Application]]]]'.\r\n\t * @param piximOptions Optional data for Pixim.\r\n\t */\r\n\tconstructor(pixiOptions: Object = {}, piximOptions: IApplicationOption = {}) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tconst app: PIXI.Application = new PIXI.Application(pixiOptions);\r\n\t\tapp.stop();\r\n\t\t\r\n\t\tapp.view.style.position = 'absolute';\r\n\t\t\r\n\t\tconst autoAdjust: TAutoAdjust = piximOptions.autoAdjust || false;\r\n\t\t\r\n\t\tthis._piximData = {\r\n\t\t\tisRun: false,\r\n\t\t\tapp,\r\n\t\t\tcontainer: piximOptions.container || document.body,\r\n\t\t\tlayers: {},\r\n\t\t\tautoAdjuster: null,\r\n\t\t\troots: {},\r\n\t\t\tcontents: {}\r\n\t\t};\r\n\t\t\r\n\t\tconst ticker: PIXI.Ticker = this._piximData.app.ticker;\r\n\t\t\r\n\t\tticker.add((delta: number) => {\r\n\t\t\t//TaskManager.done({ delta });\r\n\t\t\ttaskHandler(this._piximData.app.stage, { delta });\r\n\t\t});\r\n\t\t\r\n\t\tif (autoAdjust) {\r\n\t\t\tif (autoAdjust === true) {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tthis.fullScreen()\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthis.autoAdjuster = () => {\r\n\t\t\t\t\tautoAdjust(this);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tget app(): PIXI.Application {\r\n\t\treturn this._piximData.app;\r\n\t}\r\n\t\r\n\tget stage(): PIXI.Container {\r\n\t\treturn this._piximData.app.stage;\r\n\t}\r\n\t\r\n\tget view(): HTMLCanvasElement {\r\n\t\treturn this._piximData.app.view;\r\n\t}\r\n\t\r\n\tget container(): HTMLElement {\r\n\t\treturn this._piximData.container;\r\n\t}\r\n\t\r\n\tset container(container: HTMLElement) {\r\n\t\tthis._piximData.container = container || document.body;\r\n\t\tif (this._piximData.app.view.parentNode) {\r\n\t\t\tthis._piximData.container.appendChild(this._piximData.app.view);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Whether application has layer.\r\n\t */\r\n\tprivate _hasLayer(name: string): boolean {\r\n\t\treturn !!this._piximData.layers[name];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Add layer to application.\r\n\t */\r\n\taddLayer(name: string) {\r\n\t\tif (this._hasLayer(name)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.layers[name] = this._piximData.app.stage.addChild(new Layer());\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Remove layer form application.\r\n\t */\r\n\tremoveLayer(name: string) {\r\n\t\tif (!this._hasLayer(name)) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.app.stage.removeChild(this._piximData.layers[name]);\r\n\t\tdelete(this._piximData.layers[name]);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attach content to application.\r\n\t */\r\n\tattachAsync(content: Content, layerName: string = 'anonymous'): Promise<PIXI.Container> {\r\n\t\treturn content.buildAsync()\r\n\t\t\t.then((root: PIXI.Container) => {\r\n\t\t\t\tthis.detach(content);\r\n\t\t\t\t\r\n\t\t\t\tthis.addLayer(layerName);\r\n\t\t\t\t\r\n\t\t\t\tthis._piximData.roots[content.contentID] = root;\r\n\t\t\t\tthis._piximData.contents[content.contentID] = content;\r\n\t\t\t\tthis._piximData.layers[layerName].addChild(root);\r\n\t\t\t\t\r\n\t\t\t\treturn root;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Detach content from application.\r\n\t */\r\n\tdetach(content: Content, stageOptions: IDestroyOptions = { children: true }) {\r\n\t\tconst root: PIXI.Container = this._piximData.roots[content.contentID];\r\n\t\t\r\n\t\tif (!root) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._destroyRoot(root, stageOptions);\r\n\t\tdelete(this._piximData.roots[content.contentID]);\r\n\t\tdelete(this._piximData.contents[content.contentID]);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start application and displa viewy.\r\n\t */\r\n\tplay() {\r\n\t\tthis._piximData.container.appendChild(this._piximData.app.view);\r\n\t\t\r\n\t\treturn this.start();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start application.\r\n\t */\r\n\tstart() {\r\n\t\tthis._piximData.app.start();\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Stop application.\r\n\t */\r\n\tstop() {\r\n\t\tthis._piximData.app.stop();\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pause (or restart) application.\r\n\t */\r\n\tpause(paused: boolean) {\r\n\t\tif (paused) {\r\n\t\t\tthis.stop();\r\n\t\t} else {\r\n\t\t\tthis.start();\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tget autoAdjuster() {\r\n\t\treturn this._piximData.autoAdjuster;\r\n\t}\r\n\t\r\n\tset autoAdjuster(autoAdjuster: TAutoAdjuster) {\r\n\t\tif (this._piximData.autoAdjuster) {\r\n\t\t\twindow.removeEventListener('resize', this._piximData.autoAdjuster);\r\n\t\t}\r\n\t\t\r\n\t\tif (!autoAdjuster) {\r\n\t\t\tthis._piximData.autoAdjuster = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.autoAdjuster = autoAdjuster;\r\n\t\twindow.addEventListener('resize', autoAdjuster);\r\n\t\tautoAdjuster();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pre process to destroy application.\r\n\t */\r\n\tpreDestroy() {\r\n\t\tfor (let i in this._piximData.contents) {\r\n\t\t\tthis._piximData.contents[i].destroy();\r\n\t\t}\r\n\t\t\r\n\t\tthis.autoAdjuster = null;\r\n\t\tthis._piximData.layers = {};\r\n\t\tthis._piximData.roots = {};\r\n\t\tthis._piximData.contents = {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Destroy application.\r\n\t */\r\n\tdestroy(removeView?: boolean, stageOptions?: IDestroyOptions) {\r\n\t\tthis.preDestroy();\r\n\t\t\r\n\t\tthis._piximData.app.destroy(removeView, stageOptions);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tprivate _destroyRoot(root: PIXI.Container, stageOptions?: IDestroyOptions): void {\r\n\t\troot.destroy(stageOptions);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified rectangle.\r\n\t * \r\n\t * @param rect Rectangle to adjust.\r\n\t */\r\n\tfullScreen(rect?: IRect) {\r\n\t\tconst view: HTMLCanvasElement = this._piximData.app.view;\r\n\t\tconst r: IRect = rect || {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0,\r\n\t\t\twidth: this._piximData.container.offsetWidth || window.innerWidth,\r\n\t\t\theight: this._piximData.container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tif (r.width / r.height > view.width / view.height) {\r\n\t\t\treturn this.adjustHeight(r.height).toCenter(r).toTop(r);\r\n\t\t}\r\n\t\t\r\n\t\treturn this.adjustWidth(r.width).toMiddle(r).toLeft(r);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified width.\r\n\t * \r\n\t * @param width Width to adjust.\r\n\t */\r\n\tadjustWidth(width?: number) {\r\n\t\tconst view: HTMLCanvasElement = this._piximData.app.view;\r\n\t\tconst w: number = width || this._piximData.container.offsetWidth || window.innerWidth;\r\n\t\t\r\n\t\tconst h: number = w / view.width * view.height;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.width = `${w}px`;\r\n\t\tview.style.height = `${h}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resize canvas to fit specified height.\r\n\t * \r\n\t * @param height Height to adjust.\r\n\t */\r\n\tadjustHeight(height?: number) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst h: number = height || this._piximData.container.offsetHeight || window.innerHeight;\r\n\t\t\r\n\t\tconst w = h / view.height * view.width;\r\n\t\t\r\n\t\t//const frame = this._piximData.frame;\r\n\t\tview.style.height = `${h}px`;\r\n\t\tview.style.width = `${w}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Left justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoLeft(horizontal?: IHorizontal) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._piximData.container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Center justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoCenter(horizontal?: IHorizontal) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._piximData.container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${(hol.width - this._getViewRect().width) / 2 + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Right justified with respect to the reference data.\r\n\t * \r\n\t * @param horizontal Horizontal data used to calculate the position.\r\n\t */\r\n\ttoRight(horizontal?: IHorizontal) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst hol: IHorizontal = horizontal || {\r\n\t\t\tx: 0,\r\n\t\t\twidth: this._piximData.container.offsetWidth || window.innerWidth\r\n\t\t};\r\n\t\t\r\n\t\tview.style.left = `${hol.width - this._getViewRect().width + hol.x}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Top justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoTop(vertical?: IVertical) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._piximData.container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Middle justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoMiddle(vertical?: IVertical) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._piximData.container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${(ver.height - this._getViewRect().height) / 2 + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Bottom justified with respect to the reference data.\r\n\t * \r\n\t * @param vertical Vertical data used to calculate the position.\r\n\t */\r\n\ttoBottom(vertical?: IVertical) {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\tconst ver: IVertical = vertical || {\r\n\t\t\ty: 0,\r\n\t\t\theight: this._piximData.container.offsetHeight || window.innerHeight\r\n\t\t};\r\n\t\t\r\n\t\tview.style.top = `${ver.height - this._getViewRect().height + ver.y}px`;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\tprivate _getViewRect(): IRect {\r\n\t\tconst view = this._piximData.app.view;\r\n\t\t\r\n\t\treturn {\r\n\t\t\tx: parseInt(view.style.left.replace('px', '')),\r\n\t\t\ty: parseInt(view.style.top.replace('px', '')),\r\n\t\t\twidth: parseInt(view.style.width.replace('px', '')),\r\n\t\t\theight: parseInt(view.style.height.replace('px', ''))\r\n\t\t};\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\n\r\nexport interface IManifestDictionary<T> {\r\n\t[name: string]: T;\r\n}\r\n\r\nexport interface IPreManifest<T> {\r\n\tdata: T;\r\n\tunrequired: boolean;\r\n}\r\n\r\nexport interface IPreManifestDictionary<T> {\r\n\t[name: string]: IPreManifest<T>;\r\n}\r\n\r\nexport interface IPostManifest<T> extends IPreManifest<T> {\r\n\t//name: string;\r\n}\r\n\r\nexport interface IPostManifestDictionary<T> {\r\n\t[name: string]: IPostManifest<T>;\r\n}\r\n\r\nexport interface IContentManifestOption {\r\n\tunrequired?: boolean\r\n}\r\n\r\nexport interface ILoadedResource<T> {\r\n\tresource: T;\r\n\terror: boolean;\r\n}\r\n\r\nexport interface ILoadedResourceDictionary<T> {\r\n\t[name: string]: ILoadedResource<T>;\r\n}\r\n\r\nexport interface IResourceDictionary<T> {\r\n\t[name: string]: T;\r\n}\r\n\r\nexport interface IManifestClass {\r\n\tnew(): ContentManifestBase<any, any>;\r\n}\r\n\r\nexport function resolvePath(path: string, basepath: string) {\r\n\tif (path.indexOf('http://') === 0 || path.indexOf('https://') === 0) {\r\n\t\treturn path;\r\n\t} else {\r\n\t\treturn PIXI.utils.url.resolve(basepath, path);\r\n\t}\r\n}\r\n\r\nexport function resolveQuery(uri: string, queries: { [ name: string ]: string }): string {\r\n\tif (uri.indexOf('data:') === 0) {\r\n\t\treturn uri;\r\n\t} else {\r\n\t\tconst q = [];\r\n\t\t\r\n\t\tconst t = uri.split('?');\r\n\t\t\r\n\t\tif (t[1]) {\r\n\t\t\tconst search = t[1].split('&');\r\n\t\t\tfor (let i = 0; i < search.length; i++) {\r\n\t\t\t\tconst p = search[i].split('=');\r\n\t\t\t\tif (!(p[0] in queries)) {\r\n\t\t\t\t\tq.push(search[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i in queries) {\r\n\t\t\tq.push(`${i}=${queries[i]}`);\r\n\t\t}\r\n\t\t\r\n\t\treturn `${t[0]}?${q.join('&')}`;\r\n\t}\r\n}\r\n\r\nexport abstract class ContentManifestBase<TData, TResource> {\r\n\tprotected _manifests: IPreManifestDictionary<TData> = {};\r\n\t\r\n\t/**\r\n\t * Register manifests.\r\n\t * \r\n\t * @param manifests Defined manifests.\r\n\t * @param option Manifest option data.\r\n\t */\r\n\tadd(manifests: IManifestDictionary<TData>, options: IContentManifestOption = {}): void {\r\n\t\tconst unrequired: boolean = options.unrequired || false;\r\n\t\t\r\n\t\tfor (let i in manifests) {\r\n\t\t\tthis._manifests[i] = {\r\n\t\t\t\tdata: manifests[i],\r\n\t\t\t\tunrequired\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get resources.\r\n\t * \r\n\t * @param basepath Basement directory path of assets.\r\n\t */\r\n\tgetAsync(basepath: string, version: string, useCache: boolean): Promise<IResourceDictionary<TResource>> {\r\n\t\tconst resources: IResourceDictionary<TResource> = {};\r\n\t\t\r\n\t\tif (Object.keys(this._manifests).length === 0) {\r\n\t\t\treturn Promise.resolve(resources);\r\n\t\t}\r\n\t\t\r\n\t\treturn this._loadAsync(basepath, version, useCache)\r\n\t\t\t.then((res: ILoadedResourceDictionary<TResource>) => {\r\n\t\t\t\tfor (let i in res) {\r\n\t\t\t\t\tresources[i] = res[i].resource;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn resources;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Load resources.\r\n\t */\r\n\tprotected abstract _loadAsync(basepath: string, version: string, useCache: boolean): Promise<ILoadedResourceDictionary<TResource>>;\r\n\t\r\n\t/**\r\n\t * Destroy resources.\r\n\t */\r\n\tabstract destroyResources(resources: IResourceDictionary<TResource>): void;\r\n\t\r\n\t/**\r\n\t * Normalize asset path.\r\n\t */\r\n\tprotected _resolvePath(path: string, basepath: string): string {\r\n\t\treturn resolvePath(path, basepath);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Normalize uri query.\r\n\t */\r\n\tprotected _resolveQuery(uri: string, queries: { [ name: string ]: string }): string {\r\n\t\treturn resolveQuery(uri, queries);\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { ContentManifestBase, ILoadedResource, ILoadedResourceDictionary, IResourceDictionary, IPreManifest, IPreManifestDictionary, resolvePath, resolveQuery } from './ContentManifestBase';\r\n\r\nexport interface ILoadedImageResourceDictionary extends ILoadedResourceDictionary<PIXI.Texture> {\r\n}\r\n\r\nexport interface IImageUriManifestDictionary extends IPreManifestDictionary<string> {\r\n}\r\n\r\nexport interface IImageElementManifestDictionary extends IPreManifestDictionary<HTMLImageElement> {\r\n}\r\n\r\nexport interface IImageElementManifest extends IPreManifest<HTMLImageElement> {\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadImagesFromUrisAsync(manifests: IImageUriManifestDictionary, basepath: string, version: string, useCache: boolean) {\r\n\tif (Object.keys(manifests).length === 0) {\r\n\t\treturn Promise.resolve({});\r\n\t}\r\n\t\r\n\tconst loader: PIXI.Loader = new PIXI.Loader();\r\n\tif (version) {\r\n\t\tloader.defaultQueryString = `_fv=${version}`;\r\n\t}\r\n\t\r\n\tconst res: ILoadedImageResourceDictionary = {};\r\n\t\r\n\tfor (let i in manifests) {\r\n\t\tconst manifest = manifests[i];\r\n\t\t\r\n\t\tconst uri = resolvePath(manifest.data, basepath);\r\n\t\t/*\r\n\t\tconst uri =\r\n\t\t\tversion\r\n\t\t\t? resolveQuery(preUrl, { _fv: version })\r\n\t\t\t: preUrl;\r\n\t\t*/\r\n\t\tloader.add(i, uri, {\r\n\t\t\tcrossOrigin: true\r\n\t\t});\r\n\t}\r\n\t\r\n\tif (!useCache) {\r\n\t\tloader.use((resource: PIXI.LoaderResource, next: () => void) => {\r\n\t\t\tif (resource.texture) {\r\n\t\t\t\tPIXI.Texture.removeFromCache(resource.texture);\r\n\t\t\t\t\r\n\t\t\t\tif (resource.texture.baseTexture) {\r\n\t\t\t\t\tPIXI.BaseTexture.removeFromCache(resource.texture.baseTexture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnext();\r\n\t\t});\r\n\t}\r\n\t\r\n\treturn new Promise<ILoadedImageResourceDictionary>((resolve, reject) => {\r\n\t\tloader.load((loader, resources): void => {\r\n\t\t\tfor (let i in resources) {\r\n\t\t\t\tconst resource: PIXI.LoaderResource | undefined = resources[i];\r\n\t\t\t\t\r\n\t\t\t\tif (!resource) {\r\n\t\t\t\t\treject(i);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (resource.error) {\r\n\t\t\t\t\tif (!manifests[i].unrequired) {\r\n\t\t\t\t\t\treject(i);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tres[i] = {\r\n\t\t\t\t\tresource: resource.texture,\r\n\t\t\t\t\terror: !!resource.error\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresolve(res);\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadImagesFromElementsAsync(manifests: IImageElementManifestDictionary, version: string) {\r\n\tif (Object.keys(manifests).length === 0) {\r\n\t\treturn Promise.resolve({});\r\n\t}\r\n\t\r\n\tconst res: ILoadedImageResourceDictionary = {};\r\n\t\r\n\tconst promises: Promise<void>[] = [];\r\n\tfor (let i in manifests) {\r\n\t\tpromises.push(\r\n\t\t\tloadImageFromElementAsync(manifests[i], version)\r\n\t\t\t\t.then(resource => {\r\n\t\t\t\t\tres[i] = resource;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthrow i;\r\n\t\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises)\r\n\t\t.then(() => {\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\n\r\nexport function loadImageFromElementAsync(manifest: IPreManifest<HTMLImageElement>, version: string) {\r\n\tconst element = manifest.data;\r\n\tmanifest.data.crossOrigin = 'anonymous';\r\n\t//const preUrl = resolvePath(manifest.data.src, basepath);\r\n\tconst preUri = manifest.data.src;\r\n\t\r\n\tconst uri =\r\n\t\tversion\r\n\t\t? resolveQuery(preUri, { _fv: version })\r\n\t\t: preUri;\r\n\t\r\n\tmanifest.data.src = uri;\r\n\t\r\n\treturn loadImageAsync(manifest);\r\n}\r\n\r\n/**\r\n * @ognore\r\n */\r\nfunction loadImagesFromDataUrisAsync(manifests: IImageUriManifestDictionary) {\r\n\tif (Object.keys(manifests).length === 0) {\r\n\t\treturn Promise.resolve({});\r\n\t}\r\n\t\r\n\tconst res: ILoadedImageResourceDictionary = {};\r\n\t\r\n\tconst promises: Promise<void>[] = [];\r\n\tfor (let i in manifests) {\r\n\t\tpromises.push(\r\n\t\t\tloadImageAsync(manifests[i])\r\n\t\t\t\t.then(resource => {\r\n\t\t\t\t\tres[i] = resource;\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthrow i;\r\n\t\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises)\r\n\t\t.then(() => {\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\n\r\nexport function loadImageAsync(manifest: IPreManifest<string | HTMLImageElement>) {\r\n\treturn new Promise<ILoadedResource<PIXI.Texture>>((resolve, reject) => {\r\n\t\tconst bt = PIXI.BaseTexture.from(manifest.data);\r\n\t\tif (bt.valid) {\r\n\t\t\tresolve({\r\n\t\t\t\tresource: new PIXI.Texture(bt),\r\n\t\t\t\terror: false\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tbt.on('loaded', (baseTexture: PIXI.BaseTexture) => {\r\n\t\t\tresolve({\r\n\t\t\t\tresource: new PIXI.Texture(baseTexture),\r\n\t\t\t\terror: false\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tbt.on('error', (baseTexture: PIXI.BaseTexture, e: Error) => {\r\n\t\t\tif (manifest.unrequired) {\r\n\t\t\t\tresolve({\r\n\t\t\t\t\tresource: new PIXI.Texture(baseTexture),\r\n\t\t\t\t\terror: true\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treject();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport class ContentImageManifest extends ContentManifestBase<string | HTMLImageElement, PIXI.Texture> {\r\n\t/**\r\n\t * Load image resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tprotected _loadAsync(basepath: string, version: string, useCache: boolean): Promise<ILoadedImageResourceDictionary> {\r\n\t\tconst manifests = this._manifests;\r\n\t\t\r\n\t\t/*\r\n\t\tif (version) {\r\n\t\t\tloader.defaultQueryString = `_fv=${version}`;\r\n\t\t}\r\n\t\t*/\r\n\t\t\r\n\t\tconst elements: IImageElementManifestDictionary = {};\r\n\t\tconst dataUris: IImageUriManifestDictionary = {};\r\n\t\tconst uris: IImageUriManifestDictionary = {};\r\n\t\t\r\n\t\tfor (let i in manifests) {\r\n\t\t\tconst manifest = manifests[i];\r\n\t\t\t\r\n\t\t\tif (manifest.data instanceof HTMLImageElement) {\r\n\t\t\t\telements[i] = {\r\n\t\t\t\t\tdata: manifest.data,\r\n\t\t\t\t\tunrequired: manifest.unrequired\r\n\t\t\t\t};\r\n\t\t\t} else if (typeof manifest.data === 'string') {\r\n\t\t\t\tif (manifest.data.indexOf('data:') === 0) {\r\n\t\t\t\t\tdataUris[i] = {\r\n\t\t\t\t\t\tdata: manifest.data,\r\n\t\t\t\t\t\tunrequired: manifest.unrequired\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\turis[i] = {\r\n\t\t\t\t\t\tdata: manifest.data,\r\n\t\t\t\t\t\tunrequired: manifest.unrequired\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all([\r\n\t\t\tloadImagesFromElementsAsync(elements, version),\r\n\t\t\tloadImagesFromDataUrisAsync(dataUris),\r\n\t\t\tloadImagesFromUrisAsync(uris, basepath, version, useCache)\r\n\t\t])\r\n\t\t.then((resolvers: ILoadedImageResourceDictionary[]) => {\r\n\t\t\treturn Object.assign({}, ...resolvers);\r\n\t\t})\r\n\t\t.catch((key: string) => {\r\n\t\t\tthrow new Error(`Image: '${key}' cannot load.`);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Destroy resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tdestroyResources(resources: IResourceDictionary<PIXI.Texture>) {\r\n\t\t\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { ContentManifestBase, ILoadedResourceDictionary, IResourceDictionary, IPreManifest, IPreManifestDictionary, resolvePath, resolveQuery  } from './ContentManifestBase';\r\nimport { loadImageFromElementAsync, loadImageAsync } from './ContentImageManifest';\r\n\r\nexport interface ILoadedSpritesheetResourceDictionary extends ILoadedResourceDictionary<PIXI.ITextureDictionary> {\r\n}\r\n\r\nexport interface ISpritesheetUriManifestDictionary extends IPreManifestDictionary<string> {\r\n}\r\n\r\nexport interface ISpritesheetJson {\r\n\tframes: {\r\n\t\t[name: string]: any;\r\n\t};\r\n\t\r\n\tmeta: {\r\n\t\t[name: string]: any;\r\n\t\timage: string | HTMLImageElement;\r\n\t}\r\n}\r\n\r\nexport interface ISpritesheetJsonManifestDictionary extends IPreManifestDictionary<ISpritesheetJson> {\r\n}\r\n\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadSpritesheetsFromUrisAsync(manifests: ISpritesheetUriManifestDictionary, basepath: string, version: string, useCache: boolean) {\r\n\tif (Object.keys(manifests).length === 0) {\r\n\t\treturn Promise.resolve({});\r\n\t}\r\n\t\r\n\tconst loader: PIXI.Loader = new PIXI.Loader();\r\n\tif (version) {\r\n\t\tloader.defaultQueryString = `_fv=${version}`;\r\n\t}\r\n\t\r\n\tconst res: ILoadedSpritesheetResourceDictionary = {};\r\n\t\r\n\tfor (let i in manifests) {\r\n\t\tconst manifest = manifests[i];\r\n\t\t\r\n\t\tconst uri = resolvePath(manifest.data, basepath);\r\n\t\t/*\r\n\t\tconst uri =\r\n\t\t\tversion\r\n\t\t\t? resolveQuery(preUrl, { _fv: version })\r\n\t\t\t: preUrl;\r\n\t\t*/\r\n\t\tloader.add(i, uri, {\r\n\t\t\tcrossOrigin: true\r\n\t\t});\r\n\t}\r\n\t\r\n\tif (!useCache) {\r\n\t\tloader.use((resource: PIXI.LoaderResource, next: () => void) => {\r\n\t\t\tif (resource.textures) {\r\n\t\t\t\tfor (let i in resource.textures) {\r\n\t\t\t\t\tconst texture = resource.textures[i];\r\n\t\t\t\t\tif (!texture) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tPIXI.Texture.removeFromCache(texture);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (texture.baseTexture) {\r\n\t\t\t\t\t\tPIXI.BaseTexture.removeFromCache(texture.baseTexture);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (resource.texture) {\r\n\t\t\t\tPIXI.Texture.removeFromCache(resource.texture);\r\n\t\t\t\t\r\n\t\t\t\tif (resource.texture.baseTexture) {\r\n\t\t\t\t\tPIXI.BaseTexture.removeFromCache(resource.texture.baseTexture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnext();\r\n\t\t});\r\n\t}\r\n\t\r\n\treturn new Promise<ILoadedSpritesheetResourceDictionary>((resolve, reject) => {\r\n\t\tloader.load((loader, resources): void => {\r\n\t\t\tfor (let i in resources) {\r\n\t\t\t\tif (!manifests[i]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst resource: PIXI.LoaderResource | undefined = resources[i];\r\n\t\t\t\t\r\n\t\t\t\tif (!resource) {\r\n\t\t\t\t\treject(i);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst textures: PIXI.ITextureDictionary = resource.textures || {};\r\n\t\t\t\t\r\n\t\t\t\tif (resource.error && !manifests[i].unrequired) {\r\n\t\t\t\t\treject(i);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tres[i] = {\r\n\t\t\t\t\tresource: textures,\r\n\t\t\t\t\terror: !!resource.error\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresolve(res);\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction loadSpritesheetsFromJsonsAsync(manifests: ISpritesheetJsonManifestDictionary, basepath: string, version: string) {\r\n\tif (Object.keys(manifests).length === 0) {\r\n\t\treturn Promise.resolve({});\r\n\t}\r\n\t\r\n\tconst res: ILoadedSpritesheetResourceDictionary = {};\r\n\t\r\n\tconst promises: Promise<void>[] = [];\r\n\tfor (let i in manifests) {\r\n\t\tconst manifest = manifests[i];\r\n\t\tconst data = manifest.data.meta.image;\r\n\t\tconst unrequired = manifest.unrequired;\r\n\t\t\r\n\t\tpromises.push(\r\n\t\t\t(() => {\r\n\t\t\t\tif (data instanceof HTMLImageElement) {\r\n\t\t\t\t\treturn loadImageFromElementAsync({\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\tunrequired\r\n\t\t\t\t\t}, version);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (typeof data === 'string') {\r\n\t\t\t\t\tif (data.indexOf('data:') === 0) {\r\n\t\t\t\t\t\treturn loadImageAsync({\r\n\t\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\t\tunrequired\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst preUri = resolvePath(data, basepath);\r\n\t\t\t\t\tconst uri =\r\n\t\t\t\t\t\tversion\r\n\t\t\t\t\t\t? resolveQuery(preUri, { _fv: version })\r\n\t\t\t\t\t\t: preUri;\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn loadImageAsync({\r\n\t\t\t\t\t\tdata: uri,\r\n\t\t\t\t\t\tunrequired\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn Promise.reject();\r\n\t\t\t})()\r\n\t\t\t\t.then(resource => {\r\n\t\t\t\t\tconst ss = new PIXI.Spritesheet(resource.resource, manifest.data);\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn new Promise<void>(resolve => {\r\n\t\t\t\t\t\tss.parse(() => {\r\n\t\t\t\t\t\t\tres[i] = {\r\n\t\t\t\t\t\t\t\tresource: ss.textures,\r\n\t\t\t\t\t\t\t\terror: false\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthrow i;\r\n\t\t\t\t})\r\n\t\t);\r\n\t}\r\n\t\r\n\treturn Promise.all(promises)\r\n\t\t.then(() => {\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\n\r\nexport class ContentSpritesheetManifest extends ContentManifestBase<string, PIXI.ITextureDictionary> {\r\n\t/**\r\n\t * Load image resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tprotected _loadAsync(basepath: string, version: string, useCache: boolean): Promise<ILoadedSpritesheetResourceDictionary> {\r\n\t\tconst manifests = this._manifests;\r\n\t\t\r\n\t\tconst jsons: ISpritesheetJsonManifestDictionary = {};\r\n\t\tconst uris: ISpritesheetUriManifestDictionary = {};\r\n\t\t\r\n\t\tfor (let i in manifests) {\r\n\t\t\tconst manifest = manifests[i];\r\n\t\t\t\r\n\t\t\tif (typeof manifest.data === 'object') {\r\n\t\t\t\tjsons[i] = {\r\n\t\t\t\t\tdata: manifest.data,\r\n\t\t\t\t\tunrequired: manifest.unrequired\r\n\t\t\t\t};\r\n\t\t\t} else if (typeof manifest.data === 'string') {\r\n\t\t\t\turis[i] = {\r\n\t\t\t\t\tdata: manifest.data,\r\n\t\t\t\t\tunrequired: manifest.unrequired\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all([\r\n\t\t\tloadSpritesheetsFromJsonsAsync(jsons, basepath, version),\r\n\t\t\tloadSpritesheetsFromUrisAsync(uris, basepath, version, useCache)\r\n\t\t])\r\n\t\t.then((resolvers: ILoadedSpritesheetResourceDictionary[]) => {\r\n\t\t\treturn Object.assign({}, ...resolvers);\r\n\t\t})\r\n\t\t.catch((key: string) => {\r\n\t\t\tthrow new Error(`Spritesheet: '${key}' cannot load.`);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Destroy resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tdestroyResources(resources: IResourceDictionary<PIXI.ITextureDictionary>) {\r\n\t\t\r\n\t}\r\n}","import { Howl } from 'howler';\r\nimport { ContentManifestBase, ILoadedResourceDictionary, IResourceDictionary } from './ContentManifestBase';\r\n\r\nexport interface ILoadedSoundResourceDictionary extends ILoadedResourceDictionary<Howl> {\r\n}\r\n\r\nexport class ContentSoundManifest extends ContentManifestBase<string, Howl> {\r\n\t/**\r\n\t * Load image resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tprotected _loadAsync(basepath: string, version: string, useCache: boolean): Promise<ILoadedSoundResourceDictionary> {\r\n\t\tconst manifests = this._manifests;\r\n\t\t\r\n\t\tif (!Howl) {\r\n\t\t\treturn Promise.reject('You need \"howler.js\" to load sound asset.');\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise((resolve: (resource: ILoadedSoundResourceDictionary) => void, reject: (path: string) => void): void => {\r\n\t\t\tconst res: ILoadedSoundResourceDictionary = {};\r\n\t\t\t\r\n\t\t\tfunction loadedHandler(key: string, howl: Howl, error: boolean): void {\r\n\t\t\t\tres[key] = {\r\n\t\t\t\t\tresource: howl,\r\n\t\t\t\t\terror\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tif (++loadedCount < loadCount) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresolve(res);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet loadCount: number = 0;\r\n\t\t\tlet loadedCount:number  = 0;\r\n\t\t\t\r\n\t\t\tfor (let i in manifests) {\r\n\t\t\t\t++loadCount;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (useCache) {\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i in manifests) {\r\n\t\t\t\tconst _i = i;\r\n\t\t\t\t\r\n\t\t\t\tconst manifest = manifests[_i];\r\n\t\t\t\tconst preUrl = this._resolvePath(manifest.data, basepath);\r\n\t\t\t\t\r\n\t\t\t\tconst url =\r\n\t\t\t\t\tversion\r\n\t\t\t\t\t? this._resolveQuery(preUrl, { _fv: version })\r\n\t\t\t\t\t: preUrl;\r\n\t\t\t\t\r\n\t\t\t\tconst howl = new Howl({\r\n\t\t\t\t\tsrc: url,\r\n\t\t\t\t\tonload: () => {\r\n\t\t\t\t\t\tloadedHandler(_i, howl, false);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonloaderror: () => {\r\n\t\t\t\t\t\tif (!manifest.unrequired) {\r\n\t\t\t\t\t\t\treject(`Sound: '${_i}' cannot load.`);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tloadedHandler(_i, howl, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Destroy resources.\r\n\t * \r\n\t * @override\r\n\t */\r\n\tdestroyResources(resources: IResourceDictionary<Howl>) {\r\n\t\tfor (let i in resources) {\r\n\t\t\tresources[i].stop();\r\n\t\t\tresources[i].unload();\r\n\t\t}\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { Container } from './Container';\r\nimport { IResourceDictionary } from './ContentManifestBase';\r\n\r\nexport interface IContentLibrary {\r\n\t[name: string]: typeof PIXI.Container | typeof Container\r\n}\r\n\r\nexport interface IVariableDictionary {\r\n\t[name: string]: any;\r\n}\r\n\r\nexport interface IContentResourceDictionary {\r\n\t[name: string]: IResourceDictionary<any>;\r\n}\r\n\r\nexport interface IContentDeliverData {\r\n\twidth: number,\r\n\theight: number,\r\n\tlib: IContentLibrary,\r\n\tresources: IContentResourceDictionary,\r\n\tvars: IVariableDictionary\r\n}\r\n\r\nexport class ContentDeliver {\r\n\tprotected _piximData: IContentDeliverData;\r\n\t\r\n\tconstructor(data: IContentDeliverData) {\r\n\t\tthis._piximData = {\r\n\t\t\twidth: data.width,\r\n\t\t\theight: data.height,\r\n\t\t\tlib: data.lib,\r\n\t\t\tresources: data.resources,\r\n\t\t\tvars: data.vars\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Content width.\r\n\t */\r\n\tget width(): number {\r\n\t\treturn this._piximData.width;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Content height.\r\n\t */\r\n\tget height(): number {\r\n\t\treturn this._piximData.height;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Defined classes in content.\r\n\t */\r\n\tget lib(): IContentLibrary {\r\n\t\treturn this._piximData.lib;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Loaded resources.\r\n\t */\r\n\tget resources(): IContentResourceDictionary {\r\n\t\treturn this._piximData.resources;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Defined variables by framework.\r\n\t */\r\n\tget vars() {\r\n\t\treturn this._piximData.vars;\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport { IManifestClass, ContentManifestBase, IResourceDictionary, IManifestDictionary, IContentManifestOption } from './ContentManifestBase';\r\nimport { ContentImageManifest } from './ContentImageManifest';\r\nimport { ContentSpritesheetManifest } from './ContentSpritesheetManifest';\r\nimport { ContentSoundManifest } from './ContentSoundManifest';\r\nimport { ContentDeliver, IContentDeliverData, IVariableDictionary, IContentLibrary, IContentResourceDictionary } from './ContentDeliver';\r\n\r\nexport interface IContentAssetVersion {\r\n\t[key: string]: string;\r\n}\r\n\r\nexport interface IContentAssetCache {\r\n\t[key: string]: boolean;\r\n}\r\n\r\nexport interface IContentManifests {\r\n\t[key: string]: ContentManifestBase<any, any>;\r\n}\r\n\r\nexport interface IContentConfigData {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface IContentData {\r\n\tcontentID: string;\r\n\tbasepath: string;\r\n\tversion: IContentAssetVersion;\r\n\tuseCache: IContentAssetCache;\r\n\t$: ContentDeliver;\r\n\tmanifests: IContentManifests;\r\n\tadditionalManifests: IContentManifests;\r\n\tpreloadPromise: Promise<void> | null;\r\n\tpostloadPromise: Promise<void> | null;\r\n\tcontentDeliverData: IContentDeliverData;\r\n}\r\n\r\nexport interface TContents {\r\n\t[name: string]: typeof Content;\r\n};\r\n\r\nexport interface IContentOption {\r\n\t/**\r\n\t * Asset root path.\r\n\t */\r\n\tbasepath?: string;\r\n\t\r\n\t/**\r\n\t * Asset version.\r\n\t */\r\n\tversion?: string | IContentAssetVersion;\r\n\t\r\n\t/**\r\n\t * Whether cache textures.\r\n\t */\r\n\tuseCache?: boolean | IContentAssetCache;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _contents: TContents = {};\r\n\r\n/**\r\n * @ignore\r\n */\r\nlet _contentID: number = 0;\r\n\r\nexport interface IContentStaticData {\r\n\tconfig: IContentConfigData;\r\n\tmanifests: IContentManifests;\r\n\tlib: IContentLibrary;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction createManifests(): IContentManifests {\r\n\tconst res: IContentManifests = {};\r\n\t\r\n\tfor (let i in _manifests) {\r\n\t\tres[i] = new _manifests[i]();\r\n\t}\r\n\t\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction createContentStatic(): IContentStaticData {\r\n\treturn {\r\n\t\tconfig: {\r\n\t\t\twidth: 450,\r\n\t\t\theight: 800\r\n\t\t},\r\n\t\tmanifests: createManifests(),\r\n\t\tlib: {}\r\n\t};\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst _manifests: { [key: string]: IManifestClass } = {};\r\n\r\nexport class Content {\r\n\tprotected static _piximData: IContentStaticData;\r\n\tprotected _piximData: IContentData;\r\n\t\r\n\tconstructor(options: IContentOption = {}, piximData: IContentStaticData = Content._piximData) {\r\n\t\tconst basepath: string = (options.basepath || '');\r\n\t\t\r\n\t\tif (typeof(options.version) !== 'object') {\r\n\t\t\tconst version: IContentAssetVersion = {};\r\n\t\t\tconst v = options.version || '';\r\n\t\t\tfor (let i in _manifests) {\r\n\t\t\t\tversion[i] = v;\r\n\t\t\t}\r\n\t\t\toptions.version = version;\r\n\t\t}\r\n\t\t\r\n\t\tif (typeof(options.useCache) !== 'object') {\r\n\t\t\tconst useCache: IContentAssetCache = {};\r\n\t\t\tconst v = options.useCache || false;\r\n\t\t\tfor (let i in _manifests) {\r\n\t\t\t\tuseCache[i] = v;\r\n\t\t\t}\r\n\t\t\toptions.useCache = useCache;\r\n\t\t}\r\n\t\t\r\n\t\tconst contentDeliverData = {\r\n\t\t\twidth: piximData.config.width,\r\n\t\t\theight: piximData.config.height,\r\n\t\t\tlib: piximData.lib,\r\n\t\t\tresources: {},\r\n\t\t\tvars: {}\r\n\t\t};\r\n\t\t\r\n\t\tthis._piximData = {\r\n\t\t\tcontentID: (++_contentID).toString(),\r\n\t\t\tbasepath,\r\n\t\t\tversion: options.version,\r\n\t\t\tuseCache: options.useCache || false,\r\n\t\t\t$: new ContentDeliver(contentDeliverData),\r\n\t\t\tmanifests: piximData.manifests,\r\n\t\t\tadditionalManifests: createManifests(),\r\n\t\t\tpreloadPromise: null,\r\n\t\t\tpostloadPromise: null,\r\n\t\t\tcontentDeliverData\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Register manifest class.\r\n\t */\r\n\tstatic registerManifest(key: string, Manifest: IManifestClass) {\r\n\t\t_manifests[key] = Manifest;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create a cloned content class.\r\n\t * \r\n\t * @param key Content name.\r\n\t * @return Cloned content class.\r\n\t */\r\n\tstatic create(key: string = ''): typeof Content {\r\n\t\tif (key && key in _contents) {\r\n\t\t\tthrow new Error(`Content key '${key}' has already exists.`);\r\n\t\t}\r\n\t\t\r\n\t\tclass ContentClone extends Content {\r\n\t\t\tprotected static _piximData: IContentStaticData = createContentStatic();\r\n\t\t\t\r\n\t\t\tconstructor(options: IContentOption = {}) {\r\n\t\t\t\tsuper(options, ContentClone._piximData);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (!key) {\r\n\t\t\treturn ContentClone;\r\n\t\t}\r\n\t\t\r\n\t\treturn _contents[key] = ContentClone;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get cloned content.\r\n\t */\r\n\tstatic get(key: string) {\r\n\t\treturn _contents[key];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Remove cloned content.\r\n\t * \r\n\t * @function Pixim.Content.removeContent\r\n\t * @param key {string}\r\n\t */\r\n\tstatic remove(key: string): void {\r\n\t\tdelete(_contents[key]);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define assets for class.\r\n\t */\r\n\tstatic defineManifests<T>(key: string, data: IManifestDictionary<T>, options: IContentManifestOption = {}) {\r\n\t\tif (!this._piximData.manifests[key]) {\r\n\t\t\tconsole.warn(`Manifest '${key}' is not registered.`);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.manifests[key].add(data, options);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define image assets for class.\r\n\t */\r\n\tstatic defineImages(data: IManifestDictionary<string>, options: IContentManifestOption = {}) {\r\n\t\treturn this.defineManifests('images', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define spritesheet assets for class.\r\n\t */\r\n\tstatic defineSpritesheets(data: IManifestDictionary<string>, options: IContentManifestOption = {}) {\r\n\t\treturn this.defineManifests('spritesheets', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define sound assets for class.\r\n\t */\r\n\tstatic defineSounds(data: IManifestDictionary<string>, options: IContentManifestOption = {}) {\r\n\t\treturn this.defineManifests('sounds', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Set the content settings.\r\n\t * \r\n\t * @param data Config data.\r\n\t */\r\n\tstatic setConfig(data: IContentConfigData) {\r\n\t\t//this._piximData.config.fps = data.fps;\r\n\t\tthis._piximData.config.width = data.width;\r\n\t\tthis._piximData.config.height = data.height;\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define libraries that is material of the content.<br />\r\n\t * In the constructor named root, Application passes a reference to ContentDeliver as an argument.<br />\r\n\t * By giving this argument to the child further, you will be able to access the data freely from anywhere.\r\n\t * \r\n\t * @param data Library data.\r\n\t */\r\n\tstatic defineLibraries(data: IContentLibrary) {\r\n\t\tfor (let i in data) {\r\n\t\t\tthis._piximData.lib[i] = data[i];\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * ID of this content.\r\n\t */\r\n\tget contentID(): string {\r\n\t\treturn this._piximData.contentID;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define assets for instance.\r\n\t * \r\n\t * @return Returns itself for the method chaining.\r\n\t */\r\n\taddManifests<T>(key: string, data: IManifestDictionary<T>, options: IContentManifestOption = {}): this {\r\n\t\tif (!this._piximData.additionalManifests[key]) {\r\n\t\t\tconsole.warn(`Manifest '${key}' is not registered.`);\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\t\r\n\t\tthis._piximData.additionalManifests[key].add(data, options);\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define image assets for instance.\r\n\t * \r\n\t * @return Returns itself for the method chaining.\r\n\t */\r\n\taddImages(data: IManifestDictionary<string>, options: IContentManifestOption = {}): this {\r\n\t\treturn this.addManifests('images', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define spritesheet assets for instance.\r\n\t * \r\n\t * @return Returns itself for the method chaining.\r\n\t */\r\n\taddSpritesheets(data: IManifestDictionary<string>, options: IContentManifestOption = {}): this {\r\n\t\treturn this.addManifests('spritesheets', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define sound assets for instance.\r\n\t * \r\n\t * @return Returns itself for the method chaining.\r\n\t */\r\n\taddSounds(data: IManifestDictionary<string>, options: IContentManifestOption = {}): this {\r\n\t\treturn this.addManifests('sounds', data, options);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Define valriables for instance.\r\n\t * \r\n\t * @return Returns itself for the method chaining.\r\n\t */\r\n\taddVars(data: IVariableDictionary): this {\r\n\t\tfor (let i in data) {\r\n\t\t\t this._piximData.$.vars[i] = data[i];\r\n\t\t}\r\n\t\t\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Prepare content.\r\n\t */\r\n\tprepareAsync(): Promise<void> {\r\n\t\treturn this.preloadClassAssetAsync()\r\n\t\t\t.then(() => {\r\n\t\t\t\treturn this.preloadInstanceAssetAsync();\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Build content.\r\n\t */\r\n\tbuildAsync(): Promise<PIXI.Container> {\r\n\t\tif (!this._piximData.$.lib.root) {\r\n\t\t\tthrow new Error('There is no library named \"root\" in the content.');\r\n\t\t}\r\n\t\t\r\n\t\treturn this.prepareAsync()\r\n\t\t\t.then(() => {\r\n\t\t\t\treturn new this._piximData.$.lib.root(this._piximData.$);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Preloads class assets.\r\n\t */\r\n\tpreloadClassAssetAsync(): Promise<void> {\r\n\t\tif (this._piximData.preloadPromise) {\r\n\t\t\treturn this._piximData.preloadPromise;\r\n\t\t}\r\n\t\t\r\n\t\treturn this._piximData.preloadPromise = this._loadAssetAsync(this._piximData.manifests)\r\n\t\t\t.catch(e => {\r\n\t\t\t\tthis._piximData.preloadPromise = null;\r\n\t\t\t\t\r\n\t\t\t\tthrow e;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Preloads instance assets.\r\n\t */\r\n\tpreloadInstanceAssetAsync(): Promise<void> {\r\n\t\tif (this._piximData.postloadPromise) {\r\n\t\t\treturn this._piximData.postloadPromise;\r\n\t\t}\r\n\t\t\r\n\t\treturn this._piximData.postloadPromise = this._loadAssetAsync(this._piximData.additionalManifests)\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis._piximData.postloadPromise = null;\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tthis._piximData.postloadPromise = null;\r\n\t\t\t\t\r\n\t\t\t\tthrow e;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\tconst contentDeliverData = this._piximData.contentDeliverData;\r\n\t\t\r\n\t\tcontentDeliverData.lib = {};\r\n\t\tcontentDeliverData.vars = {};\r\n\t\t\r\n\t\tconst resources = contentDeliverData.resources;\r\n\t\tconst manifests = this._piximData.manifests;\r\n\t\t\r\n\t\tfor (let i in resources) {\r\n\t\t\tif (i in manifests) {\r\n\t\t\t\tmanifests[i].destroyResources(resources[i]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresources[i] = {};\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate _loadAssetAsync(manifests: IContentManifests): Promise<void> {\r\n\t\tconst basepath: string = this._piximData.basepath;\r\n\t\tconst version: IContentAssetVersion = this._piximData.version;\r\n\t\tconst useCache: IContentAssetCache = this._piximData.useCache;\r\n\t\tconst resources: IContentResourceDictionary = this._piximData.$.resources;\r\n\t\t\r\n\t\tconst loaderCount = Object.keys(manifests).length;\r\n\t\t\r\n\t\tif (loaderCount === 0) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\t\r\n\t\tconst promises: Promise<IResourceDictionary<any>>[] = [];\r\n\t\tconst keys: string[] = [];\r\n\t\tfor (let i in manifests) {\r\n\t\t\tconst type = i;\r\n\t\t\tkeys.push(type);\r\n\t\t\t\r\n\t\t\tpromises.push(manifests[type].getAsync(basepath, version[type] || '', useCache[type] || false));\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises)\r\n\t\t\t.then(resolver => {\r\n\t\t\t\tfor (let i: number = 0; i < resolver.length;i++) {\r\n\t\t\t\t\tresources[keys[i]] = resources[keys[i]] || {};\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let j in resolver[i]) {\r\n\t\t\t\t\t\tresources[keys[i]][j] = resolver[i][j];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nContent.registerManifest('images', ContentImageManifest);\r\nContent.registerManifest('spritesheets', ContentSpritesheetManifest);\r\nContent.registerManifest('sounds', ContentSoundManifest);","import * as PIXI from 'pixi.js';\r\n\r\nexport function resolvePath(path: string, basepath: string) {\r\n\tif (path.indexOf('http://') === 0 || path.indexOf('https://') === 0) {\r\n\t\treturn path;\r\n\t} else {\r\n\t\treturn PIXI.utils.url.resolve(basepath.replace(/([^\\/])$/, '$1/'), path);\r\n\t}\r\n}\r\n\r\nexport function resolveQuery(uri: string, queries: { [ name: string ]: any }): string {\r\n\tif (uri.indexOf('data:') === 0) {\r\n\t\treturn uri;\r\n\t} else {\r\n\t\tconst q = [];\r\n\t\t\r\n\t\tconst t = uri.split('?');\r\n\t\t\r\n\t\tif (t[1]) {\r\n\t\t\tconst search = t[1].split('&');\r\n\t\t\tfor (let i = 0; i < search.length; i++) {\r\n\t\t\t\tconst p = search[i].split('=');\r\n\t\t\t\tif (!(p[0] in queries)) {\r\n\t\t\t\t\tq.push(search[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i in queries) {\r\n\t\t\tq.push(`${i}=${queries[i]}`);\r\n\t\t}\r\n\t\t\r\n\t\treturn `${t[0]}?${q.join('&')}`;\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport * as utils from '../utils/index';\r\n\r\nexport abstract class LoaderResource<T> {\r\n\tprotected _data: T;\r\n\tprotected _error: any;\r\n\t\r\n\tconstructor(data: T, error: any) {\r\n\t\tthis._data = data;\r\n\t\tthis._error = error;\r\n\t}\r\n\t\r\n\tabstract destroy(): void;\r\n\t\r\n\tget data() {\r\n\t\treturn this._data;\r\n\t}\r\n\t\r\n\tget error() {\r\n\t\treturn this._error;\r\n\t}\r\n}\r\n\r\nexport type TLoaderResourceVersion = string | number;\r\n\r\nexport interface ILoaderOption {\r\n\tbasepath?: string;\r\n\tversion?: TLoaderResourceVersion;\r\n\tuseCache?: boolean;\r\n}\r\n\r\nexport interface ILoaderResourceDictionary<T> {\r\n\t[ name: string ]: LoaderResource<T>;\r\n}\r\n\r\nexport interface ILoaderManifest<T> {\r\n\t[ name: string ]: T;\r\n}\r\n\r\nexport abstract class LoaderBase<TTarget, TResource> {\r\n\tprotected _options: ILoaderOption;\r\n\t\r\n\tconstructor(options: ILoaderOption = {}) {\r\n\t\tthis._options = options;\r\n\t}\r\n\t\r\n\tabstract loadAsync(target: TTarget, options: ILoaderOption): Promise<LoaderResource<TResource>>;\r\n\tabstract loadWithManifestAsync(manifest: ILoaderManifest<TTarget>, options: ILoaderOption): Promise<ILoaderResourceDictionary<TResource>>;\r\n\t\r\n\tprotected _resolveBasepath(basepath?: string) {\r\n\t\treturn typeof basepath === 'string' ? basepath : (this._options.basepath || '');\r\n\t}\r\n\t\r\n\tprotected _resolveVersion(version?: TLoaderResourceVersion) {\r\n\t\treturn (typeof version === 'string' || typeof version === 'number') ? version : (this._options.version || '');\r\n\t}\r\n\t\r\n\tprotected _resolveUseCache(useCache?: boolean) {\r\n\t\treturn typeof useCache === 'boolean' ? useCache : (this._options.useCache || false);\r\n\t}\r\n\t\r\n\tprotected _resolveUrl(url: string, options: ILoaderOption = {}) {\r\n\t\tconst preUri = utils.resolvePath(url, this._resolveBasepath(options.basepath));\r\n\t\tconst version = this._resolveVersion(options.version);\r\n\t\t\r\n\t\tconst uri =\r\n\t\t\tversion\r\n\t\t\t? utils.resolveQuery(preUri, { _fv: version })\r\n\t\t\t: preUri;\r\n\t\t\r\n\t\treturn uri;\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport * as LoaderBase from './LoaderBase';\r\n\r\nexport class TextureLoaderResource extends LoaderBase.LoaderResource<PIXI.Texture> {\r\n\tdestroy() {\r\n\t\tTextureLoaderResource.removeCache(this._data);\r\n\t\tthis._data.destroy(true);\r\n\t}\r\n\t\r\n\tstatic removeCache(texture: PIXI.Texture) {\r\n\t\tPIXI.Texture.removeFromCache(texture);\r\n\t\t\r\n\t\tif (texture.baseTexture) {\r\n\t\t\tPIXI.BaseTexture.removeFromCache(texture.baseTexture);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport type TTextureLoaderElementTarget = HTMLImageElement | HTMLVideoElement;\r\n\r\nexport type TTextureLoaderTarget = string | TTextureLoaderElementTarget;\r\n\r\nexport interface ITextureLoaderManifest extends LoaderBase.ILoaderManifest<TTextureLoaderTarget> {\r\n\r\n}\r\n\r\nexport interface ITextureLoaderResourceDictionary extends LoaderBase.ILoaderResourceDictionary<PIXI.Texture> {\r\n\r\n}\r\n\r\nexport interface ITextureLoaderOption extends LoaderBase.ILoaderOption {\r\n\r\n}\r\n\r\nexport class TextureLoader extends LoaderBase.LoaderBase<TTextureLoaderTarget, PIXI.Texture> {\r\n\tloadAsync(target: TTextureLoaderTarget, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tif (target instanceof HTMLImageElement || target instanceof HTMLVideoElement) {\r\n\t\t\treturn this._loadFromElementAsync(target, options);\r\n\t\t} else if (target.indexOf('data:') === 0) {\r\n\t\t\treturn this._loadFromDataUriAsync(target, options);\r\n\t\t} else {\r\n\t\t\treturn this._loadFromUrlAsync(target, options);\r\n\t\t}\r\n\t}\r\n\t\r\n\tloadWithManifestAsync(manifest: ITextureLoaderManifest, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tif (Object.keys(manifest).length === 0) {\r\n\t\t\treturn Promise.resolve({});\r\n\t\t}\r\n\t\t\r\n\t\tconst promises = [];\r\n\t\tconst res: ITextureLoaderResourceDictionary = {};\r\n\t\t\r\n\t\tfor (let i in manifest) {\r\n\t\t\tpromises.push(\r\n\t\t\t\tthis.loadAsync(manifest[i], options)\r\n\t\t\t\t\t.then(resource => {\r\n\t\t\t\t\t\tres[i] = resource;\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises)\r\n\t\t\t.then(() => {\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tprivate _loadFromUrlAsync(url: string, options: LoaderBase.ILoaderOption = {}) {\r\n\t\treturn this._loadTextureAsync(this._resolveUrl(url, options), options);\r\n\t}\r\n\t\r\n\tprivate _loadFromElementAsync(element: TTextureLoaderElementTarget, options: LoaderBase.ILoaderOption = {}) {\r\n\t\telement.crossOrigin = 'anonymous';\r\n\t\telement.src = this._resolveUrl(element.src, options);\r\n\t\t\r\n\t\treturn this._loadTextureAsync(element);\r\n\t}\r\n\t\r\n\tprivate _loadFromDataUriAsync(dataUri: string, options: LoaderBase.ILoaderOption = {}) {\r\n\t\treturn this._loadTextureAsync(dataUri, options);\r\n\t}\r\n\t\r\n\tprivate _loadTextureAsync(target: TTextureLoaderTarget, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tconst useCache = this._resolveUseCache(options.useCache);\r\n\t\t\r\n\t\treturn new Promise<TextureLoaderResource>(resolve => {\r\n\t\t\tconst bt = PIXI.BaseTexture.from(target);\r\n\t\t\t\r\n\t\t\tif (bt.valid) {\r\n\t\t\t\tresolve(new TextureLoaderResource(new PIXI.Texture(bt), null));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tbt.on('loaded', (baseTexture: PIXI.BaseTexture) => {\r\n\t\t\t\tif (!useCache) {\r\n\t\t\t\t\tPIXI.BaseTexture.removeFromCache(baseTexture);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresolve(new TextureLoaderResource(new PIXI.Texture(baseTexture), null));\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tbt.on('error', (baseTexture: PIXI.BaseTexture, e: Error) => {\r\n\t\t\t\tPIXI.BaseTexture.removeFromCache(baseTexture);\r\n\t\t\t\tresolve(new TextureLoaderResource(new PIXI.Texture(baseTexture), e));\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}","import * as PIXI from 'pixi.js';\r\nimport * as LoaderBase from './LoaderBase';\r\nimport * as TextureLoader from './TextureLoader';\r\nimport * as utils from '../utils/index';\r\n\r\nexport class SpritesheetLoaderResource extends LoaderBase.LoaderResource<PIXI.ITextureDictionary> {\r\n\tdestroy() {\r\n\t\tfor (let i in this._data) {\r\n\t\t\tTextureLoader.TextureLoaderResource.removeCache(this._data[i]);\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i in this._data) {\r\n\t\t\tthis._data[i].destroy(true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport interface ISpritesheetJson {\r\n\tframes: {\r\n\t\t[name: string]: any;\r\n\t};\r\n\t\r\n\tmeta: {\r\n\t\t[name: string]: any;\r\n\t\timage: string | HTMLImageElement;\r\n\t}\r\n}\r\n\r\nexport type TSpritesheetLoaderTarget = string | ISpritesheetJson;\r\n\r\nexport interface ISpritesheetLoaderManifest extends LoaderBase.ILoaderManifest<TSpritesheetLoaderTarget> {\r\n\r\n}\r\n\r\nexport interface ISpritesheetLoaderUrlManifest extends LoaderBase.ILoaderManifest<string> {\r\n\r\n}\r\n\r\nexport interface ISpritesheetLoaderJsonManifest extends LoaderBase.ILoaderManifest<ISpritesheetJson> {\r\n\r\n}\r\n\r\nexport interface ISpritesheetLoaderResourceDictionary extends LoaderBase.ILoaderResourceDictionary<PIXI.ITextureDictionary> {\r\n\r\n}\r\n\r\nexport interface ISpritesheetLoaderOption extends LoaderBase.ILoaderOption {\r\n\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst KEY_SINGLE_SPRITESHEET = '--single-sprite-sheet';\r\n\r\nexport class SpritesheetLoader extends LoaderBase.LoaderBase<TSpritesheetLoaderTarget, PIXI.ITextureDictionary> {\r\n\tloadAsync(target: TSpritesheetLoaderTarget, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tif (typeof target === 'string') {\r\n\t\t\treturn this._loadFromUrlsAsync({ [KEY_SINGLE_SPRITESHEET]: target }, options)\r\n\t\t\t\t.then(resources => {\r\n\t\t\t\t\treturn resources[KEY_SINGLE_SPRITESHEET];\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn this._loadFromJsonsAsync({ [KEY_SINGLE_SPRITESHEET]: target }, options)\r\n\t\t\t\t.then(resources => {\r\n\t\t\t\t\treturn resources[KEY_SINGLE_SPRITESHEET];\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\tloadWithManifestAsync(manifest: ISpritesheetLoaderManifest, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tif (Object.keys(manifest).length === 0) {\r\n\t\t\treturn Promise.resolve({});\r\n\t\t}\r\n\t\t\r\n\t\tconst promises = [];\r\n\t\tconst urls: ISpritesheetLoaderUrlManifest = {};\r\n\t\tconst jsons: ISpritesheetLoaderJsonManifest = {};\r\n\t\t\r\n\t\tfor (let i in manifest) {\r\n\t\t\tconst target = manifest[i];\r\n\t\t\t\r\n\t\t\tif (typeof target === 'string') {\r\n\t\t\t\turls[i] = target;\r\n\t\t\t} else {\r\n\t\t\t\tjsons[i] = target;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all([\r\n\t\t\tthis._loadFromUrlsAsync(urls, options),\r\n\t\t\tthis._loadFromJsonsAsync(jsons, options)\r\n\t\t])\r\n\t\t.then(resolvers => {\r\n\t\t\treturn Object.assign({}, ...resolvers);\r\n\t\t});\r\n\t}\r\n\t\r\n\tprivate _loadFromUrlsAsync(manifest: ISpritesheetLoaderUrlManifest, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tconst res: ISpritesheetLoaderResourceDictionary = {};\r\n\t\t\r\n\t\tif (Object.keys(manifest).length === 0) {\r\n\t\t\treturn Promise.resolve(res);\r\n\t\t}\r\n\t\t\r\n\t\tconst loader = new PIXI.Loader();\r\n\t\t\r\n\t\tconst version = this._resolveVersion(options.version);\r\n\t\tif (version) {\r\n\t\t\tloader.defaultQueryString = `_fv=${version}`;\r\n\t\t}\r\n\t\t\r\n\t\tconst basepath = this._resolveBasepath(options.basepath);\r\n\t\tfor (let i in manifest) {\r\n\t\t\tconst target = manifest[i];\r\n\t\t\tconst uri = utils.resolvePath(target, basepath);\r\n\t\t\tloader.add(i, uri, {\r\n\t\t\t\tcrossOrigin: true\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst useCache = this._resolveUseCache(options.useCache);\r\n\t\tif (!useCache) {\r\n\t\t\tloader.use((resource: PIXI.LoaderResource, next: () => void) => {\r\n\t\t\t\tif (resource.textures) {\r\n\t\t\t\t\tfor (let i in resource.textures) {\r\n\t\t\t\t\t\tconst texture = resource.textures[i];\r\n\t\t\t\t\t\tif (!texture) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tTextureLoader.TextureLoaderResource.removeCache(texture);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (resource.texture) {\r\n\t\t\t\t\tTextureLoader.TextureLoaderResource.removeCache(resource.texture);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tnext();\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\treturn new Promise<ISpritesheetLoaderResourceDictionary>(resolve => {\r\n\t\t\tloader.load((loader, resources) => {\r\n\t\t\t\tfor (let i in resources) {\r\n\t\t\t\t\tif (!manifest[i]) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst resource: PIXI.LoaderResource | undefined = resources[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!resource) {\r\n\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource({}, 'invalid json');\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (resource.error) {\r\n\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource({}, resource.error);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!resource.textures) {\r\n\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource({}, 'invalid texture');\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tres[i] = new SpritesheetLoaderResource(resource.textures, null);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresolve(res);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\tprivate _loadFromJsonsAsync(manifest: ISpritesheetLoaderJsonManifest, options: LoaderBase.ILoaderOption = {}) {\r\n\t\tconst res: ISpritesheetLoaderResourceDictionary = {};\r\n\t\t\r\n\t\tif (Object.keys(manifest).length === 0) {\r\n\t\t\treturn Promise.resolve(res);\r\n\t\t}\r\n\t\t\r\n\t\tconst promises = [];\r\n\t\tconst loader = new TextureLoader.TextureLoader(options);\r\n\t\t\r\n\t\tfor (let i in manifest) {\r\n\t\t\tconst target = manifest[i];\r\n\t\t\tpromises.push(\r\n\t\t\t\tloader.loadAsync(target.meta.image, options)\r\n\t\t\t\t\t.then(resource => {\r\n\t\t\t\t\t\tif (resource.error) {\r\n\t\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource({}, resource.error);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst ss = new PIXI.Spritesheet(resource.data, target);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn new Promise<void>(resolve => {\r\n\t\t\t\t\t\t\tss.parse(e => {\r\n\t\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource(ss.textures, null);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => {\r\n\t\t\t\t\t\tres[i] = new SpritesheetLoaderResource({}, e);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t\t\r\n\t\treturn Promise.all(promises)\r\n\t\t\t.then(() => {\r\n\t\t\tconsole.log(res)\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n}","import * as LoaderBase from '../loaders/LoaderBase';\r\n\r\nexport interface IResourceManagerData<T> {\r\n\ttarget: T;\r\n\tunrequired: boolean;\r\n}\r\n\r\nexport interface IResourceManagerManifest<T> {\r\n\t[ name: string ]: IResourceManagerData<T>;\r\n}\r\n\r\nexport interface IResourceManagerOption {\r\n\tunrequired?: boolean;\r\n}\r\n\r\nexport interface IResourceManifest<T> {\r\n\t[ name: string ]: T;\r\n}\r\n\r\nexport interface IRawResourceDictionary<T> {\r\n\t[ name: string ]: T;\r\n}\r\n\r\nexport abstract class ResourceManagerBase<TTarget, TResource> {\r\n\tprotected _data: IResourceManagerManifest<TTarget> = {};\r\n\t//private _resources:\r\n\t\r\n\t/**\r\n\t * Register manifests.\r\n\t */\r\n\tadd(manifest: LoaderBase.ILoaderManifest<TTarget>, options: IResourceManagerOption = {}): void {\r\n\t\tconst unrequired = options.unrequired || false;\r\n\t\t\r\n\t\tfor (let i in manifest) {\r\n\t\t\tthis._data[i] = {\r\n\t\t\t\ttarget: manifest[i],\r\n\t\t\t\tunrequired\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Get resources.\r\n\t */\r\n\tgetAsync(options: LoaderBase.ILoaderOption): Promise<IRawResourceDictionary<TResource>> {\r\n\t\tif (Object.keys(this._data).length === 0) {\r\n\t\t\treturn Promise.resolve({});\r\n\t\t}\r\n\t\t\r\n\t\tconst manifest: LoaderBase.ILoaderManifest<TTarget> = {};\r\n\t\t\r\n\t\tfor (let i in this._data) {\r\n\t\t\tmanifest[i] = this._data[i].target;\r\n\t\t}\r\n\t\t\r\n\t\treturn this._loadAsync(manifest, options)\r\n\t\t\t.then(resources => {\r\n\t\t\t\tconst res: IRawResourceDictionary<TResource> = {};\r\n\t\t\t\t\r\n\t\t\t\tfor (let i in resources) {\r\n\t\t\t\t\tconst resource = resources[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (resource.error && !this._data[i].unrequired) {\r\n\t\t\t\t\t\tthrow resource.error;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tres[i] = resource.data;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Load resources.\r\n\t */\r\n\tprotected abstract _loadAsync(manifest: LoaderBase.ILoaderManifest<TTarget>, options: LoaderBase.ILoaderOption): Promise<LoaderBase.ILoaderResourceDictionary<TResource>>;\r\n\t\r\n\tdestoryResources() {\r\n\t\r\n\t}\r\n}","import * as ResourceManagerBase from './ResourceManagerBase';\r\nimport * as TextureLoader from '../loaders/TextureLoader';\r\n\r\nexport interface ITextureDictionary extends ResourceManagerBase.IRawResourceDictionary<PIXI.Texture> {\r\n\r\n}\r\n\r\nexport class ImageResourceManager extends ResourceManagerBase.ResourceManagerBase<TextureLoader.TTextureLoaderTarget, PIXI.Texture> {\r\n\tprotected _loadAsync(manifest: TextureLoader.ITextureLoaderManifest ,options: TextureLoader.ITextureLoaderOption = {}) {\r\n\t\tconst loader = new TextureLoader.TextureLoader(options);\r\n\t\t\r\n\t\treturn loader.loadWithManifestAsync(manifest);\r\n\t}\r\n}"],"names":["Emitter","this","_events","_on","type","callback","once","const","events","i","length","push","on","off","splice","_emit","context","targets","event","let","apply","args","emit","cemit","_emitAll","emitAll","cemitAll","clear","_Emitter","Task","callbacks","_taskData","enabled","index","value","add","prototypeAccessors","Array","isArray","list","Function","done","task","_to","Number","first","prev","next","to","finish","reset","destroy","tasks","super","_piximData","emitter","_Task","Container","taskEnabledChildren","updateTask","e","taskEnabled","PIXI.Container","Layer","taskHandler","obj","children","child","Application","pixiOptions","piximOptions","app","PIXI.Application","stop","view","style","position","autoAdjust","isRun","container","document","body","layers","autoAdjuster","roots","contents","ticker","delta","stage","fullScreen","parentNode","appendChild","_hasLayer","name","addLayer","addChild","removeLayer","removeChild","attachAsync","content","layerName","buildAsync","then","root","detach","contentID","stageOptions","_destroyRoot","play","start","pause","paused","window","removeEventListener","addEventListener","preDestroy","removeView","rect","r","x","y","width","offsetWidth","innerWidth","height","offsetHeight","innerHeight","adjustHeight","toCenter","toTop","adjustWidth","toMiddle","toLeft","w","h","horizontal","hol","left","_getViewRect","toRight","vertical","ver","top","toBottom","parseInt","replace","resolvePath","path","basepath","indexOf","PIXI.utils","url","resolve","resolveQuery","uri","queries","q","t","split","search","join","ContentManifestBase","loadImagesFromUrisAsync","manifests","version","useCache","Object","keys","Promise","loader","PIXI.Loader","defaultQueryString","res","data","crossOrigin","use","resource","texture","PIXI.Texture","removeFromCache","baseTexture","PIXI.BaseTexture","reject","load","resources","error","unrequired","loadImagesFromElementsAsync","promises","loadImageFromElementAsync","catch","all","manifest","preUri","src","_fv","loadImageAsync","loadImagesFromDataUrisAsync","bt","from","valid","options","_manifests","getAsync","_loadAsync","_resolvePath","_resolveQuery","ContentImageManifest","elements","dataUris","uris","HTMLImageElement","resolvers","assign","key","Error","destroyResources","loadSpritesheetsFromUrisAsync","textures","loadSpritesheetsFromJsonsAsync","meta","image","ss","PIXI.Spritesheet","parse","ContentSpritesheetManifest","jsons","ContentSoundManifest","Howl","loadedHandler","howl","loadedCount","loadCount","_i","preUrl","onload","onloaderror","unload","ContentDeliver","lib","vars","_contents","_contentID","createManifests","Content","piximData","v","contentDeliverData","config","toString","$","additionalManifests","preloadPromise","postloadPromise","registerManifest","Manifest","create","ContentClone","get","remove","defineManifests","console","warn","defineImages","defineSpritesheets","defineSounds","setConfig","defineLibraries","addManifests","addImages","addSpritesheets","addSounds","addVars","prepareAsync","preloadClassAssetAsync","preloadInstanceAssetAsync","_loadAssetAsync","resolver","j","LoaderResource","_data","_error","LoaderBase","_options","_resolveBasepath","_resolveVersion","_resolveUseCache","_resolveUrl","utils.resolvePath","utils.resolveQuery","TextureLoaderResource","removeCache","LoaderBase.LoaderResource","TextureLoader","loadAsync","target","HTMLVideoElement","_loadFromElementAsync","_loadFromDataUriAsync","_loadFromUrlAsync","loadWithManifestAsync","_loadTextureAsync","element","dataUri","LoaderBase.LoaderBase","SpritesheetLoaderResource","TextureLoader.TextureLoaderResource","SpritesheetLoader","_loadFromUrlsAsync","_loadFromJsonsAsync","urls","TextureLoader.TextureLoader","log","ResourceManagerBase","destoryResources","ImageResourceManager","ResourceManagerBase.ResourceManagerBase"],"mappings":"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"}